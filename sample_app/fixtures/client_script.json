[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee",
  "enabled": 0,
  "modified": "2024-07-31 07:02:04.503829",
  "module": "sample app",
  "name": "Sample Client Script",
  "script": "frappe.listview_settings['Employee'] = {\r\n    hide_name_column: true,\r\n    refresh:function(listview){\r\n        hide_filter()    \r\n        add_custom_export(listview)\r\n    },\r\n    add_fields: [\"status\"],\r\n    onload: function(listview) {\r\n        hide_filter()  \r\n        add_custom_export(listview)\r\n    }\r\n};\r\n\r\nfunction add_custom_export(listview){\r\n    \tlistview.page.add_inner_button(__(\"All\"), function(){\r\n    \t    var selected_items = listview.get_checked_items(true);\r\n    \t    let allowed_fields = [];\r\n// \t\t\tconst exclude_fields = [\"naming_series\", \"employee\", \"first_name\", \"middle_name\", \"last_name\", \"marital_status\", \"ctc\",\r\n// \t\t\t\t\"employee_name\", \"status\", \"image\", \"gender\", \"date_of_birth\", \"date_of_joining\", \"lft\", \"rgt\", \"old_parent\",\"custom_\"];\r\n\t\t\tconst exclude_fields = [\"naming_series\", \"lft\", \"rgt\", \"old_parent\",\"custom_emp_id\",\"user_id\",\"custom_current_job_title\",\"custom_job_rank\",\"custom_job_level\",\"custom_department_shorthand\"];\r\n    \t    const exclude_field_types = [\"HTML\", \"Section Break\", \"Column Break\", \"Button\", \"Read Only\", \"Tab Break\", \"Table\",\"Attach\",\"Attach Image\",\"custom_job_level_detail\",\"custom_months_worked_to_date\",\"Heading\"];\r\n    \t   // const employeeInfo = [\"Employee Number\", \"Company\", \"Branch\", \"Group\", \"Department\", \"Function\", \"First Name\",\"Middle Name\",\"Last Name\",\"suffix\",\"Birthdate\",\"Gender\",\"Marital Status\",\"Citizenship\",\"Present Address\",\"Mobile Number\",\"Email\",\"Position\",\"Hiring Date\",\"Regularization Date\",\"Termination Date\",\"Employment Status\",\"Salary Type\",\"Daily Salary\",\"Monthly Salary\",\"Daily Allowance\",\"Salary Mode\",\"Bank Name\",\"Bank Account Number\",\"TIN\",\"SSS Number\",\"Philhealth Number\",\"Pagibig Number\",\"Default Shift\"];\r\n    \t   // console.log(listview.meta.fields)\r\n    \t    let fields = listview.meta.fields\r\n    \t    const field_label_map = {};\r\n        \tfields.map((data) =>{\r\n                field_label_map[data.fieldname] = __(data.label);\r\n                if( !in_list(exclude_field_types, data.fieldtype)\r\n                    && !in_list(exclude_fields, data.fieldname)\r\n                    && !data.hidden\r\n            \t\t&& !data.read_only\r\n                   ){\r\n                    allowed_fields.push({\r\n                        label: field_label_map[data.fieldname],\r\n                        value: data.fieldname,\r\n                        // [data.fieldname]: field_label_map[data.fieldname]\r\n            \t    });\r\n                }\r\n            })\r\n            \r\n            // allowed_fields.push({ employees: selected_items })\r\n            if(selected_items.length > 0){\r\n                frappe.call({\r\n                method:'scic.api.custom_export',\r\n                args:{data: allowed_fields, employees: selected_items }\r\n                }).then((data) =>{\r\n                    var link = document.createElement(\"a\");\r\n                    link.href = \"data:text/csv;charset=utf-8,\" + encodeURI(data.message);\r\n                    link.download = `Employee.csv`;\r\n                    document.body.appendChild(link);\r\n                    link.click();\r\n                    document.body.removeChild(link);\r\n                    console.log(\"array:\".data)\r\n                }).then(() => uncheck_all())\r\n            }else{\r\n                frappe.msgprint(\"Please Select an Employee\")\r\n            }\r\n            \r\n            // console.log(selected_items)\r\n            console.log(allowed_fields)\r\n    \t    \r\n    \t    \r\n    \t}, \"Export Employee\")\r\n    \t\r\n    \tlistview.page.add_inner_button(__(\"Standard\"), function(){\r\n    \t    var selected_items = listview.get_checked_items(true);\r\n    \t    if(selected_items.length > 0){\r\n                frappe.call({\r\n                method:'scic.api.custom_export_2',\r\n                args:{employees: selected_items }\r\n                }).then((data) =>{\r\n                    var link = document.createElement(\"a\");\r\n                    link.href = \"data:text/csv;charset=utf-8,\" + encodeURI(data.message);\r\n                    link.download = `Employee.csv`;\r\n                    document.body.appendChild(link);\r\n                    link.click();\r\n                    document.body.removeChild(link);\r\n                    console.log(\"array:\".data)\r\n                }).then(() => uncheck_all())\r\n            }else{\r\n                frappe.msgprint(\"Please Select an Employee\")\r\n            }\r\n    \t},\"Export Employee\")\r\n}\r\nfunction uncheck_all(){\r\n    \t$.each(cur_list.$checks, (i, el) => {\r\n\t\tlet docname = $(el).attr(\"data-name\");\r\n\t\tcur_list.$result\r\n\t\t\t.find(`.list-row-checkbox[data-name='${docname}']`)\r\n\t\t\t.prop(\"checked\", false);\r\n\t});\r\n\tcur_list.on_row_checked();\r\n}\r\n\r\n\r\n\r\nfunction hide_filter(){\r\n    $(\".list-row-col span:contains('Employee Number')\").attr('data-sort-by','custom_emp_id')\r\n    $('.sort-selector-button ul [data-value=\"employee_number\"]').hide()\r\n    $('.sort-selector-button ul [data-value=\"name\"]').hide()\r\n    $('.standard-filter-section [data-fieldname=\"custom_full_name\"]').attr(\"placeholder\", \"First, Last Name\"); //change placeholder\r\n    $('.standard-filter-section [data-fieldname=\"custom_full_name\"]').attr(\"data-original-title\", \"First, Last Name\"); //change tooltip\r\n    $('.standard-filter-section [data-fieldname=\"name\"]').remove()\r\n    $('.standard-filter-section [data-fieldname=\"employee_number\"]').remove()\r\n}",
  "view": "Form"
 }
]